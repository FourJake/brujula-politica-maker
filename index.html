<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Br√∫jula Pol√≠tica Maker</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
body {
    background:#0f0f0f;
    color:white;
    font-family:Arial, sans-serif;
    text-align:center;
    margin:0;
    padding:12px;
}

h1 {
    margin: 8px 0 6px 0;
    font-size: 22px;
}

p {
    font-size: 14px;
    margin-bottom: 10px;
}

#canvas-container {
    display:flex;
    justify-content:center;
    align-items:center;
}

canvas{
    border:2px solid #aaa;
    background:#111;
    touch-action:manipulation;
    max-width: 92vw;
    max-height: 92vw;
    width: 500px;
    height: 500px;
}

/* POPUP */
#popup{
    position:fixed;
    top:50%;
    left:50%;
    transform:translate(-50%,-50%);
    background:#222;
    padding:18px 15px 15px;
    border-radius:12px;
    display:none;
    z-index:10;
    width: 260px;
    box-shadow: 0 10px 30px rgba(0,0,0,.6);
}

#popup input[type="text"]{
    width:100%;
    margin:6px 0 12px;
    padding:8px;
    border-radius:8px;
    border:none;
    font-size:14px;
}

/* COLOR PICKER FIX */
#popup input[type="color"]{
    -webkit-appearance: none;
    appearance: none;
    width: 100%;
    height: 42px;
    border: none;
    border-radius: 10px;
    padding: 0;
    background: none;
    cursor: pointer;
}

#popup input[type="color"]::-webkit-color-swatch-wrapper {
    padding: 0;
}

#popup input[type="color"]::-webkit-color-swatch {
    border-radius: 10px;
    border: 2px solid #444;
}

#popup button{
    width:100%;
    margin-top:12px;
    padding:10px;
    border-radius:10px;
    border:none;
    background:#eee;
    font-size:15px;
}

#closePopup{
    position:absolute;
    top:6px;
    right:10px;
    font-size:18px;
    cursor:pointer;
    color:#bbb;
}

#closePopup:hover{
    color:white;
}

#version {
    position: fixed;
    bottom: 8px;
    right: 10px;
    font-size: 11px;
    color: #bbb;
    opacity: 0.8;
}
</style>
</head>
<body>

<h1>üß≠ Br√∫jula Pol√≠tica Maker</h1>
<p>
Toc√° una <b>intersecci√≥n</b> para crear un punto<br>
Toc√° un <b>punto existente</b> para eliminarlo
</p>

<div id="canvas-container">
    <canvas id="canvas" width="500" height="500"></canvas>
</div>

<div id="popup">
    <div id="closePopup" onclick="closePopup()">‚úï</div>
    <input id="pointName" type="text" placeholder="Nombre del punto">
    <input id="pointColor" type="color" value="#ff0000">
    <button onclick="addPoint()">Crear punto</button>
</div>

<div id="version">v1.6 ¬∑ color picker fixed</div>

<script>
const VERSION = "v1.6 ¬∑ color picker fixed";

const canvas=document.getElementById("canvas");
const ctx=canvas.getContext("2d");
const size=canvas.width;
const gridSize=25;
const center=size/2;
const points=[];
let px=null,py=null;

document.getElementById("version").textContent = VERSION;

function drawQuadrants(){
    ctx.fillStyle="rgba(255,80,80,0.35)";
    ctx.fillRect(0,0,center,center);
    ctx.fillStyle="rgba(80,120,255,0.35)";
    ctx.fillRect(center,0,center,center);
    ctx.fillStyle="rgba(120,255,120,0.35)";
    ctx.fillRect(0,center,center,center);
    ctx.fillStyle="rgba(190,140,255,0.35)";
    ctx.fillRect(center,center,center,center);
}

function drawGrid(){
    ctx.clearRect(0,0,size,size);
    drawQuadrants();

    ctx.strokeStyle="#333";
    for(let i=0;i<=size;i+=gridSize){
        ctx.beginPath(); ctx.moveTo(i,0); ctx.lineTo(i,size); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0,i); ctx.lineTo(size,i); ctx.stroke();
    }

    ctx.strokeStyle="#aaa";
    ctx.lineWidth=2;
    ctx.beginPath(); ctx.moveTo(center,0); ctx.lineTo(center,size); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(0,center); ctx.lineTo(size,center); ctx.stroke();
    ctx.lineWidth=1;

    ctx.fillStyle="white";
    ctx.font="12px Arial";
    ctx.fillText("Autoritario",center-38,14);
    ctx.fillText("Libertario",center-38,size-6);
    ctx.fillText("Izq.",5,center-4);
    ctx.fillText("Der.",size-32,center-4);

    drawPoints();
}

function drawPoints(){
    points.forEach(p=>{
        ctx.beginPath();
        ctx.arc(p.x,p.y,6,0,Math.PI*2);
        ctx.fillStyle=p.color;
        ctx.fill();
        ctx.fillStyle="white";
        ctx.fillText(p.name,p.x+8,p.y-8);
    });
}

canvas.addEventListener("click",e=>{
    const r=canvas.getBoundingClientRect();
    let x=(e.clientX-r.left)*(size/r.width);
    let y=(e.clientY-r.top)*(size/r.height);

    for(let i=points.length-1;i>=0;i--){
        const p=points[i];
        if(Math.hypot(p.x-x,p.y-y)<8){
            if(confirm("¬øEliminar este punto?")){
                points.splice(i,1);
                drawGrid();
            }
            return;
        }
    }

    let gx=Math.round(x/gridSize)*gridSize;
    let gy=Math.round(y/gridSize)*gridSize;

    if(Math.abs(gx-x)<10 && Math.abs(gy-y)<10){
        px=gx; py=gy;
        document.getElementById("popup").style.display="block";
    }
});

function closePopup(){
    document.getElementById("popup").style.display="none";
}

function addPoint(){
    const name=document.getElementById("pointName").value||"Punto";
    const color=document.getElementById("pointColor").value;
    points.push({x:px,y:py,name,color});
    closePopup();
    document.getElementById("pointName").value="";
    drawGrid();
}

drawGrid();
</script>

</body>
</html>
